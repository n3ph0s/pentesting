# AWK - Text Manipulation

awk is a utility that enables a programmer to write tiny but effective programs in the form of statements that define text patterns that are to be searched for in each line of a document and the action that is to be taken when a match is found within a line.

1. AWK Operations:
    - Scans a file line by line
    - Splits each input line into fields
    - Compares input line/fields to pattern
    - Performs action(s) on matched lines

2. Useful To:
    - Transform data files
    - Produce formatted reports

3. Programming Constructs:
    - Format output lines
    - Arithmetic and string operations
    - Conditionals and loops
        - [Default behaviour of awk](#Default-behaviour-of-awk)
        - [Print the lines which match with the given pattern](#Print-the-lines-which-match-with-the-given-pattern)
        - [Splitting a Line Into Fields](#Splitting-a-Line-Into-Fields)
        - [Built-In Variables In awk](#Built-In-Variables-In-awk)
        - [Use of NR built-in variables (Display Line Number)](#Use-of-NR-built-in-variables-(Display-Line-Number))
        - [Use of NF built-in variables (Display Last Field)](#Use-of-NF-built-in-variables-(Display-Last-Field))
        - [Another use of NR built-in variables (Display Line From 3 to 6)](#Another-use-of-NR-built-in-variables-(Display-Line-From-3-to-6))
        - [To print the first item along with the row number(NR) separated with ” – “ from each line the file](#To-print-the-first-item-along-with-the-row-number-NR)-separated-with-”-–-“-from-each-line-the-file)
        - [To print lines with more than 15 characters](#To-print-lines-with-more-than-15-characters)
        - [To find/check for any string in any column](#To-find\/check-for-any-string-in-any-column)
        - [To convert the output to UPPER/lower case](#To-convert-the-output-to-UPPER\/lower-case)

For the purposes of this cheat sheet, we will use a plain text file called `employee.txt` that has the following data:

```
cat > employee.txt 
ajay manager account 45000
sunil clerk account 25000
varun manager sales 50000
amit manager account 47000
tarun peon sales 15000
deepak clerk sales 23000
sunil peon sales 13000
satvik director purchase 80000 
```

## Default behaviour of awk

```
reciprocity:~ david$ awk '{print}' employee.txt
ajay manager account 45000
sunil clerk account 25000
varun manager sales 50000
amit manager account 47000
tarun peon sales 15000
deepak clerk sales 23000
sunil peon sales 13000
satvik director purchase 80000
```

## Print the lines which match with the given pattern

```
reciprocity:~ david$ awk '/manager/ {print}' employee.txt
ajay manager account 45000
varun manager sales 50000
amit manager account 47000
```

## Splitting a Line Into Fields

For each record i.e line, the awk command splits the record delimited by whitespace character by default and stores it in the $n variables. If the line has 4 words, it will be stored in $1, $2, $3 and $4 respectively. Also, $0 represents the whole line.

```
reciprocity:~ david$ awk '{print $1, $4}' employee.txt
ajay 45000
sunil 25000
varun 50000
amit 47000
tarun 15000
deepak 23000
sunil 13000
satvik 80000
```

## Built-In Variables In awk

awk’s built-in variables include the field variables—$1, $2, $3, and so on ($0 is the entire line) — that break a line of text into individual words or pieces called fields.

**NR**: NR command keeps a current count of the number of input records. Remember that records are usually lines. awk command performs the pattern/action statements once for each record in a file.

**NF**: NF command keeps a count of the number of fields within the current input record.**

**FS**: FS command contains the field separator character which is used to divide fields on the input line. The default is “white space”, meaning space and tab characters. FS can be reassigned to another character (typically in BEGIN) to change the field separator.

**RS**: RS command stores the current record separator character. Since, by default, an input line is the input record, the default record separator character is a newline.

**OFS**: OFS command stores the output field separator, which separates the fields when awk prints them. The default is a blank space. Whenever print has several parameters separated with commas, it will print the value of OFS in between each parameter.

**ORS**: ORS command stores the output record separator, which separates the output lines when awk prints them. The default is a newline character. print automatically outputs the contents of ORS at the end of whatever it is given to print.

## Use of NR built-in variables (Display Line Number)

```
reciprocity:~ david$ awk '{print NR, $0}' employee.txt
1 ajay manager account 45000
2 sunil clerk account 25000
3 varun manager sales 50000
4 amit manager account 47000
5 tarun peon sales 15000
6 deepak clerk sales 23000
7 sunil peon sales 13000
8 satvik director purchase 80000
```

In the above example, the awk command with NR prints all the lines along with the line number

## Use of NF built-in variables (Display Last Field)

```
reciprocity:~ david$ awk '{print $1, $NF}' employee.txt
ajay 45000
sunil 25000
varun 50000
amit 47000
tarun 15000
deepak 23000
sunil 13000
satvik 80000
```

**NF** = Number of Fields and if you don’t enter the $ value in front of NF it will return the count of the total number of fields. $NFreturns the last field

## Another use of NR built-in variables (Display Line From 3 to 6)

```
reciprocity:~ david$ awk 'NR==3, NR==6 {print NR, $0}' employee.txt
3 varun manager sales 50000
4 amit manager account 47000
5 tarun peon sales 15000
6 deepak clerk sales 23000
```

The following are some more examples with the following text:

```
reciprocity:~ david$ cat test.txt
A    B    C
Tarun    A12    1
Man    B6    2
Praveen    M42    3
```

## To print the first item along with the row number(NR) separated with ” – “ from each line in the file

```
reciprocity:~ david$ awk '{print NR, "-", $1}' test.txt
1 - A
2 - Tarun
3 - Man
4 - Praveen
```

## To print lines with more than 15 characters

```
reciprocity:~ david$ awk 'length($0) > 15 ' test.txt
Tarun    A12    1
Praveen    M42    3
```

## To find/check for any string in any column

```
reciprocity:~ david$ awk '{if($2 == "B6") print $0}' test.txt
Man    B6    2
```

This can also be achieved with a simple query, but you lose the power of formating the output in the following example

```
reciprocity:~ david$ awk '$2 == "B6"' test.txt
Man    B6    2
```

## To convert the output to UPPER/lower case

```
reciprocity:~ david$ awk '{print toupper($0)}' test.txt
A    B    C
TARUN    A12    1
MAN    B6    2
PRAVEEN    M42    3
```
```
reciprocity:~ david$ awk '{print tolower($0)}' test.txt
a    b    c
tarun    a12    1
man    b6    2
praveen    m42    3
```
