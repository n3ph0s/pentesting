# Tools

## Active Directory Module

It is possible to use ADModule without having to install RSAT.  [Active Directory Module](https://github.com/samratashok/ADModule) 

# Enumeration 

## Domain

Get Domain

``` PowerShell
Get-ADDomain
Get-ADDomain -Identity <targetdomain>

```

Get Domain SID 

``` PowerShell
(Get-ADDomain).DomainSID
(Get-ADDomain -Identity <targetdomain).DomainSID
```

Get Domain Controllers
``` PowerShell
Get-ADDomainController
Get-ADDomainController -DomainName <targetdomain> -Discover
``` 

## Users

Get a list of users in the current domain

``` PowerShell
Get-ADUser -Filter * -Properties * 
Get-ADUser -Identity student1 -Properties *
Get-ADUser -Filter * -Properties * | select samaccountname
```

To list all properties for users or to find a specific value

``` PowerShell
Get-ADUser -Filter * -Properties * | where description -NE $null | select cn,description
Get-ADUser -Filter * -Properties * | select name,@{expression={[datetime]::fromFileTime($_.pwdlastset)}}
```

To find a particular string in the users attributes

``` PowerShell
Get-ADUser -Filter 'Description -like "*built*"'  -Properties * | select cn, description
```

## Groups

List all Groups in a Domain

``` PowerShell
Get-ADGroup -Filter * | select Name
Get-ADGroup -Filter * -Properties *
``` 

List all Groups containing the word "admin" in name

``` PowerShell
Get-ADGroup -Filter 'Name -like "*admin*"' | select Name
```

Get Members of the Group Domain Admins

``` PowerShell
Get-ADGroup -Identity "Domain Admins" -Recursive
```

Get the Group Membership for a specific user

``` PowerShell
Get-ADPrincipalGroupMembership -Identity student1
Get-ADGroupMember -Identity "Domain Admins"
Get-ADGroupMember -Identity "Enterprise Admins" -Server moneycorp.local
```

## Computers / Session Information

Get a list of computers in domain

``` PowerShell
Get-ADComputer -Filter * | select Name
Get-ADComputer -Filter * -Properties *
Get-ADComputer -Filter 'OperatingSystem -like "*Server 2016*"' -Properties OperatingSystem | select Name,OperatingSystem
``` 

## Shares

Find shares on hosts in domain

``` PowerShell
Get-NetComputer | Get-NetShare
``` 

## OU / GPO

List all OU's

``` PowerShell
Get-ADOrganizationalUnit -Filter *
Get-ADOrganizationalUnit -Filter * -Properties *
``` 

Get list of computers in a specified OU

``` PowerShell
Get-ADComputer -SearchBase 'OU=StudentMachines,DC=dollarcorp,DC=moneycorp,DC=local' -Filter *
```

## ACLs

To get Object ACL's associated with a specific object

``` PowerShell
(Get-Acl 'AD:\CN=administrator,CN=Users,DC=dollarcorp,DC=moneycorp,dc=local').access
``` 

## Forest, Domains and Trusts

Forest Mapping

``` PowerShell
Get-ADForest 
Get-ADForest -Identity eurocorp.local
``` 

Get all domains in Forest

``` PowerShell
(Get-ADForest).Domains
(Get-ADForest -Identity eurocorp.local).Domains
```

Get all Global Catalogs in Forest

``` PowerShell
(Get-ADForest).GlobalCatalogs
(Get-ADForest -Identity eurocorp.local).GlobalCatalogs
```

Map Trusts of Domain

``` PowerShell
Get-ADTrust -Filter *
```

# Privilege Escalation

Kerberoasting - Find users accounts being used as Service Accounts

``` PowerShell
Get-ADUser -Filter {ServicePrincipalName -ne "$null"} -Properties ServicePrincipalName
``` 

AS-Rep Roasting

``` PowerShell
Get-ADUser -Filter {DoesNotRequirePreAuth -eq $True} -Properties DoesNotRequirePreAuth
```

Unconstrained Delegation

``` PowerShell
Get-ADUser -Filter {TrustedForDelegation -eq $True}
Get-ADComputer -Filter {TrustedForDelegation -eq $True}
```

Constrained Delegation

``` PowerShell
Get-ADObject -Filter {msDs-AllowedtoDelegateTo -ne "$null"} -Properties msDS-AllowedToDelegateTo
```